Version 4
SHEET 1 7540 2260
WIRE 6752 -336 6208 -336
WIRE 6880 -336 6752 -336
WIRE 6960 -336 6880 -336
WIRE 7008 -336 6960 -336
WIRE 7344 -336 7008 -336
WIRE 6752 -304 6752 -336
WIRE 6880 -288 6880 -336
WIRE 6960 -288 6960 -336
WIRE 7344 -240 7344 -336
WIRE 6752 -176 6752 -224
WIRE 6880 -176 6880 -224
WIRE 6880 -176 6752 -176
WIRE 6960 -176 6960 -224
WIRE 6960 -176 6880 -176
WIRE -1808 -160 -1968 -160
WIRE 2896 -128 2896 -224
WIRE 7344 -128 7344 -160
WIRE -1808 -112 -1808 -160
WIRE -48 -96 -96 -96
WIRE 96 -96 32 -96
WIRE 6208 -80 6160 -80
WIRE 6304 -80 6208 -80
WIRE 6368 -80 6304 -80
WIRE 6496 -80 6432 -80
WIRE 6528 -80 6496 -80
WIRE 6672 -80 6592 -80
WIRE 1376 -64 1296 -64
WIRE 1536 -64 1456 -64
WIRE 1632 -64 1600 -64
WIRE 2272 -64 2176 -64
WIRE 2464 -64 2352 -64
WIRE 2736 -64 2464 -64
WIRE 5296 -64 5296 -176
WIRE -2384 -32 -2384 -64
WIRE 3168 -32 3056 -32
WIRE 3360 -32 3248 -32
WIRE 3440 -32 3360 -32
WIRE 6208 -32 6208 -80
WIRE 7008 -32 7008 -336
WIRE -1376 -16 -1440 -16
WIRE 6496 -16 6496 -80
WIRE -1184 0 -1312 0
WIRE -1104 0 -1184 0
WIRE 2464 0 2464 -64
WIRE 2560 0 2464 0
WIRE 2736 0 2640 0
WIRE -1808 16 -1808 -32
WIRE -1376 16 -1808 16
WIRE 7344 16 7344 -48
WIRE -432 32 -528 32
WIRE -320 32 -432 32
WIRE -96 32 -96 -96
WIRE -96 32 -240 32
WIRE -48 32 -96 32
WIRE -1808 48 -1808 16
WIRE 96 48 96 -96
WIRE 96 48 16 48
WIRE 272 48 96 48
WIRE 1152 48 1024 48
WIRE 1296 48 1296 -64
WIRE 1296 48 1232 48
WIRE 1376 48 1296 48
WIRE 5296 48 5296 16
WIRE 5376 48 5296 48
WIRE 5552 48 5456 48
WIRE 6304 48 6304 -80
WIRE 6368 48 6304 48
WIRE 6800 48 6624 48
WIRE 6912 48 6880 48
WIRE 6960 48 6912 48
WIRE -48 64 -80 64
WIRE 1632 64 1632 -64
WIRE 1632 64 1440 64
WIRE 1680 64 1632 64
WIRE 2624 64 2608 64
WIRE 2736 64 2704 64
WIRE -2384 80 -2384 48
WIRE -2272 80 -2384 80
WIRE 1376 80 1296 80
WIRE 5296 80 5296 48
WIRE -2272 96 -2272 80
WIRE 3120 96 3056 96
WIRE 3152 96 3120 96
WIRE 3280 96 3232 96
WIRE 3488 96 3280 96
WIRE -1440 128 -1440 -16
WIRE -1184 128 -1184 0
WIRE -1184 128 -1440 128
WIRE 2608 128 2608 64
WIRE 2736 128 2608 128
WIRE 5136 128 5088 128
WIRE 5232 128 5216 128
WIRE 6304 128 6304 48
WIRE 6368 128 6304 128
WIRE 6672 128 6672 -80
WIRE 6672 128 6624 128
WIRE 6912 128 6672 128
WIRE 7008 128 7008 64
WIRE 7008 128 6912 128
WIRE 7344 128 7344 96
WIRE 7344 128 7008 128
WIRE -320 144 -528 144
WIRE -80 144 -80 64
WIRE -80 144 -240 144
WIRE 3696 144 3696 16
WIRE 3120 160 3120 96
WIRE 3280 160 3280 96
WIRE 3360 160 3360 -32
WIRE -1808 176 -1808 128
WIRE 6368 208 6160 208
WIRE 6736 208 6624 208
WIRE 7008 208 7008 128
WIRE -2384 224 -2384 80
WIRE 1296 240 1296 80
WIRE -1968 272 -1968 -160
WIRE -1808 272 -1808 256
WIRE -1808 272 -1968 272
WIRE -80 288 -80 224
WIRE 6736 288 6736 208
WIRE 6816 288 6736 288
WIRE 6928 288 6896 288
WIRE 6960 288 6928 288
WIRE -1808 304 -1808 272
WIRE 3696 320 3696 224
WIRE 5296 320 5296 176
WIRE 6208 320 6208 48
WIRE 6304 320 6304 192
WIRE 6304 320 6208 320
WIRE 6496 320 6496 272
WIRE 6496 320 6304 320
WIRE 3488 336 3488 96
WIRE 3488 336 2528 336
WIRE 6496 352 6496 320
WIRE 2608 384 2608 128
WIRE 3440 384 2608 384
WIRE 6928 384 6928 368
WIRE 7008 384 7008 304
WIRE 7008 384 6928 384
WIRE 7008 400 7008 384
WIRE 2608 432 2608 384
WIRE 2608 544 2608 496
WIRE 2896 544 2896 192
WIRE 2896 544 2608 544
WIRE 3024 544 2896 544
WIRE 3120 544 3120 224
WIRE 3120 544 3024 544
WIRE 3280 544 3280 240
WIRE 3280 544 3120 544
WIRE 3360 544 3360 240
WIRE 3360 544 3280 544
WIRE 3024 576 3024 544
WIRE 32 944 -16 944
WIRE 192 944 112 944
WIRE 3008 1040 2960 1040
WIRE 3168 1040 3088 1040
WIRE -16 1072 -16 944
WIRE -16 1072 -448 1072
WIRE 48 1072 -16 1072
WIRE 192 1088 192 944
WIRE 192 1088 112 1088
WIRE 304 1088 192 1088
WIRE -448 1104 -448 1072
WIRE 48 1104 -16 1104
WIRE 2960 1168 2960 1040
WIRE 2960 1168 2624 1168
WIRE 3024 1168 2960 1168
WIRE 3168 1184 3168 1040
WIRE 3168 1184 3088 1184
WIRE 3280 1184 3168 1184
WIRE 2624 1200 2624 1168
WIRE 3024 1200 2928 1200
WIRE -448 1312 -448 1184
WIRE 2624 1376 2624 1280
WIRE 3568 1888 3504 1888
WIRE 3808 1904 3632 1904
WIRE 3888 1904 3808 1904
WIRE 5888 1904 5696 1904
WIRE 1296 1920 1264 1920
WIRE 1472 1920 1376 1920
WIRE 1600 1920 1472 1920
WIRE 3280 1920 3072 1920
WIRE 3456 1920 3360 1920
WIRE 3568 1920 3536 1920
WIRE 4688 1920 4656 1920
WIRE 4864 1920 4768 1920
WIRE 4992 1920 4864 1920
WIRE 1472 1984 1472 1920
WIRE 3456 1984 3456 1920
WIRE 3536 1984 3536 1920
WIRE 3536 1984 3456 1984
WIRE 4864 1984 4864 1920
WIRE 5888 1984 5888 1904
WIRE 3504 2000 3504 1888
WIRE 3680 2000 3504 2000
WIRE 3808 2000 3808 1904
WIRE 3808 2000 3760 2000
WIRE 3280 2032 3072 2032
WIRE 3456 2032 3456 1984
WIRE 3456 2032 3360 2032
WIRE 1472 2096 1472 2048
WIRE 4864 2096 4864 2048
WIRE 3504 2112 3504 2080
WIRE 3504 2112 3312 2112
WIRE 3312 2144 3312 2112
FLAG -80 288 0
FLAG -16 16 VCC
FLAG -16 80 VEE
FLAG -2272 96 0
FLAG -2384 -64 VCC
FLAG -2384 224 VEE
FLAG -432 32 VIN
FLAG 3024 576 0
FLAG 5296 320 0
FLAG 2624 1376 0
FLAG 3056 1152 VCC
FLAG 3056 1216 VEE
FLAG 3312 2144 0
FLAG 3600 1872 VCC
FLAG 3600 1936 VEE
FLAG 7008 400 0
FLAG 6496 352 0
FLAG 6752 -176 0
FLAG 6160 -80 5Vs
IOPIN 6160 -80 Out
FLAG 5696 1904 V_LEM
IOPIN 5696 1904 Out
FLAG 4656 1920 V_LEM
IOPIN 4656 1920 In
FLAG 5888 2064 0
FLAG 6160 208 MOTOR_IN
IOPIN 6160 208 In
FLAG 4000 800 5Vs
IOPIN 4000 800 Out
FLAG 6208 -336 24Vs
IOPIN 6208 -336 Out
FLAG -448 1312 0
FLAG 80 1056 VCC
FLAG 80 1120 VEE
FLAG -1808 304 0
FLAG -1104 0 V_ordered
IOPIN -1104 0 Out
FLAG -528 144 V_ordered
IOPIN -528 144 In
FLAG 3440 -32 PWM_OUT
IOPIN 3440 -32 Out
FLAG 272 48 Diff_Amp_OUT
IOPIN 272 48 Out
FLAG -1344 -32 VCC
FLAG -1344 32 VEE
FLAG 2176 -64 PI_OUT
IOPIN 2176 -64 In
FLAG 2896 -224 VCC
FLAG 5088 128 PWM
IOPIN 5088 128 In
FLAG 5296 -176 VCC
FLAG 5552 48 MOTOR_IN
IOPIN 5552 48 Out
FLAG 3440 384 RT/CT
IOPIN 3440 384 Out
FLAG 4864 2096 0
FLAG 4992 1920 V_LEM_LPF
IOPIN 4992 1920 Out
FLAG 3072 1920 V_LEM_LPF
IOPIN 3072 1920 In
FLAG 3072 2032 RT/CT
IOPIN 3072 2032 In
FLAG 3888 1904 Sum_Amp_OUT
IOPIN 3888 1904 Out
FLAG 2928 1200 Sum_Amp_OUT
IOPIN 2928 1200 In
FLAG 3280 1184 I_SENSE
IOPIN 3280 1184 Out
FLAG 2528 336 I_SENSE
IOPIN 2528 336 In
FLAG -528 32 V_FB
IOPIN -528 32 In
FLAG 304 1088 V_FB
IOPIN 304 1088 Out
FLAG -16 1104 FB_Scaler_IN
IOPIN -16 1104 In
FLAG 1024 48 Diff_Amp_OUT
IOPIN 1024 48 In
FLAG 1680 64 PI_OUT
IOPIN 1680 64 Out
FLAG 1408 32 VCC
FLAG 1408 96 VEE
FLAG 1296 240 0
FLAG 1264 1920 Sum_Amp_OUT
IOPIN 1264 1920 In
FLAG 1472 2096 0
FLAG 1600 1920 FB_Scaler_IN
IOPIN 1600 1920 Out
FLAG 3696 320 0
FLAG 3696 16 PWM
IOPIN 3696 16 Out
SYMBOL AD822 -16 -16 R0
SYMATTR InstName U1
SYMBOL res -224 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 5k
SYMBOL res -224 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 5k
SYMBOL res -64 240 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R3
SYMATTR Value 5k
SYMBOL res 48 -112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 5k
SYMBOL voltage -2384 -48 R0
SYMATTR InstName V3
SYMATTR Value 15
SYMBOL LT1243 2896 32 R0
SYMATTR InstName U2
SYMBOL res 2720 48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL voltage -1808 160 R0
SYMATTR InstName V6
SYMATTR Value 5
SYMBOL npn 5232 80 R0
SYMATTR InstName Q1
SYMATTR Value 2N3904
SYMBOL res 5280 -80 R0
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL res 5472 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL AD822 3056 1120 R0
SYMATTR InstName U3
SYMBOL res 2608 1184 R0
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL res 3104 1024 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL AD822 3600 1840 R0
SYMATTR InstName U4
SYMBOL res 3376 1904 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL res 3376 2016 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL res 3776 1984 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 100
SYMBOL res 3488 1984 R0
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL LTC4449 6496 128 R0
SYMATTR InstName U5
SYMBOL nmos 6960 -32 R0
SYMATTR InstName M1
SYMATTR Value IPB011N04L
SYMBOL nmos 6960 208 R0
SYMATTR InstName M2
SYMATTR Value IPB011N04L
SYMBOL res 6896 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 39 47 VTop 2
SYMATTR InstName R14
SYMATTR Value 10
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL res 6912 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 10
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL ind 7328 -256 R0
SYMATTR InstName L1
SYMATTR Value 100µ
SYMBOL res 7328 -144 R0
SYMATTR InstName R16
SYMATTR Value .05
SYMBOL schottky 6368 -64 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value SS3P5
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage 6208 -48 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V10
SYMATTR Value 5
SYMBOL cap 6592 -96 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 0.22µ
SYMBOL battery 6752 -320 R0
WINDOW 0 -56 17 Left 2
WINDOW 3 -58 75 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V11
SYMATTR Value 24
SYMBOL polcap 6864 -288 R0
WINDOW 0 -29 9 Left 2
WINDOW 3 -62 48 Left 2
SYMATTR InstName C3
SYMATTR Value 1500µ
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=50 Irms=2.41 Rser=0.026 Lser=0 mfg="Nichicon" pn="UPL1H152MRH" type="Al electrolytic"
SYMBOL cap 6944 -288 R0
WINDOW 0 -28 3 Left 2
WINDOW 3 -46 48 Left 2
SYMATTR InstName C4
SYMATTR Value 100n
SYMBOL cap 6288 128 R0
SYMATTR InstName C5
SYMATTR Value 0.1µ
SYMATTR SpiceLine V=16 Irms=1.02 Rser=0.0850352 Lser=0 mfg="KEMET" pn="C1206F104K4RAC" type="X7R"
SYMBOL res 6896 32 R0
WINDOW 0 38 40 Left 2
WINDOW 3 43 76 Left 2
SYMATTR InstName R17
SYMATTR Value 10k
SYMBOL res 6912 272 R0
SYMATTR InstName R18
SYMATTR Value 10k
SYMBOL bv 5888 1968 M0
SYMATTR InstName B1
SYMATTR Value V=0.00416*I(L1)+2.5
SYMBOL voltage 7344 0 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V12
SYMATTR Value 10
SYMBOL AD822 80 1024 R0
SYMATTR InstName U6
SYMBOL res -464 1088 R0
SYMATTR InstName R19
SYMATTR Value 1k
SYMBOL res 128 928 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 1k
SYMBOL res -1824 32 R0
SYMATTR InstName R21
SYMATTR Value 5k
SYMBOL res -1824 -128 R0
SYMATTR InstName R22
SYMATTR Value 5k
SYMBOL AD822 -1344 -64 R0
SYMATTR InstName U7
SYMBOL res 3344 144 R0
SYMATTR InstName R25
SYMATTR Value 10k
SYMBOL cap 2592 432 R0
SYMATTR InstName C6
SYMATTR Value 0.01µ
SYMBOL cap 3104 160 R0
SYMATTR InstName C7
SYMATTR Value 0.01µ
SYMBOL res 3248 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 10k
SYMBOL res 3296 256 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R27
SYMATTR Value 10k
SYMBOL res 4784 1904 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 10k
SYMBOL cap 4848 1984 R0
SYMATTR InstName C1
SYMATTR Value 0.01µ
SYMBOL AD822 1408 0 R0
SYMATTR InstName U8
SYMBOL res 1248 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R29
SYMATTR Value 5k
SYMBOL res 1472 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R30
SYMATTR Value 5k
SYMBOL cap 1600 -80 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value 0.01µ
SYMBOL res 1392 1904 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value 10k
SYMBOL cap 1456 1984 R0
SYMATTR InstName C9
SYMATTR Value 0.01µ
SYMBOL res 2368 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R32
SYMATTR Value 10k
SYMBOL res 2656 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R33
SYMATTR Value 10k
SYMBOL res 3264 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R34
SYMATTR Value 10k
SYMBOL res 5232 112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R35
SYMATTR Value 10k
SYMBOL voltage 3696 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PULSE(0 15 0 0 0 150u 200u)
TEXT -1176 328 Left 2 !.tran 50
TEXT 5744 1736 Left 2 ;LEM
TEXT 3352 832 Left 2 ;Non-Inverting Amplifier
TEXT 3936 1664 Left 2 ;Summing Amplifier
TEXT 2816 -400 Left 2 ;PWM Chip
TEXT 5312 -392 Left 2 ;Inverter
TEXT 1256 -360 Left 2 ;PI Control
TEXT -88 -280 Left 2 ;Differential Amplifer
TEXT -1704 -280 Left 2 ;Voltage Source
TEXT 6736 -408 Left 2 ;Motor
TEXT 256 760 Left 2 ;Non-Inverting Amplifier
TEXT 4752 1736 Left 2 ;Low-Pass Filter
TEXT 1632 1656 Left 2 ;Low Pass Filter
RECTANGLE Normal 608 400 -752 -256 2
RECTANGLE Normal 4384 688 1920 -368 2
RECTANGLE Normal 3616 1568 2528 864 2
RECTANGLE Normal 4448 2256 2560 1696 2
RECTANGLE Normal -928 400 -2784 -256 2
RECTANGLE Normal 1840 416 752 -336 2
RECTANGLE Normal 5840 416 4832 -368 2
RECTANGLE Normal 7536 464 5968 -400 2
RECTANGLE Normal 6080 2208 5408 1760 2
RECTANGLE Normal 496 1424 -624 784 2
RECTANGLE Normal 2112 2256 960 1696 2
RECTANGLE Normal 5200 2208 4528 1760 2
